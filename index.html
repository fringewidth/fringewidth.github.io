<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </meta>
  <title>hrishik sai bojnal</title>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked-custom-heading-id/lib/index.umd.js"></script>
  <script>
    const plugin = window.markedCustomHeadingId.default || window.markedCustomHeadingId;
    marked.use(plugin());
  </script>
  <link rel="stylesheet" href="index.css">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
</head>

<body>
  <a id="header"></a>
  <div id="navbar"></div>
  <div id="content">powering up...</div>
  <footer>
    <div id="footer"></div>
  </footer>

  <script>
    function loadMd(id, file) {
      $.get(file, md => $(id).html(marked.parse(md)));
    }

    function getParam(name) {
      return new URLSearchParams(window.location.search).get(name)
    }

    $(function () {
      $.getJSON("config.json", config => {
        loadMd("#header", config.header)
        loadMd("#navbar", config.navbar)
        const contentFile = getParam("content") || config.home
        loadMd("#content", contentFile)
      })
    })

    $(document).on("click", 'a[href$=".md"]:not([href^="https://"])', e => {
      e.preventDefault()
      const href = $(e.currentTarget).attr("href")
      history.pushState(null, '', '?content=' + href)
      loadMd("#content", href)
    })

    $(window).on("popstate", () => {
      $.getJSON("config.json", config => {
        const contentFile = getParam("content") || config.home
        loadMd("#content", contentFile)
      })
    })

    const FooterAnimator = {
      config: null,
      index: 0,
      interval: null,
      lastSleep: null,

      async init() {
        const response = await fetch("config.json")
        this.config = (await response.json()).footerAnimation
        this.update()
      },

      update() {
        const now = new Date()
        const time = new Date(now.toLocaleString("en-US", { timeZone: "Asia/Kolkata" }))
        const hour = time.getHours()
        const isSleep = hour >= this.config.sleepTime.start || hour < this.config.sleepTime.end

        if (this.lastSleep !== isSleep) {
          this.lastSleep = isSleep
          this.index = 0
          clearInterval(this.interval)
          this.interval = setInterval(() => this.update(),
            isSleep ? this.config.intervals.sleep : this.config.intervals.awake)
        }

        const kaomojis = isSleep ? this.config.kaomojis.sleeping : this.config.kaomojis.awake
        const kaomoji = kaomojis[this.index]
        const formatted = time.toLocaleTimeString("en-US", { hour: 'numeric', minute: '2-digit', hour12: true })

        $("#footer").html(`it's ${formatted} here.... <span class=nowrap>${kaomoji}</span>`)
        this.index = (this.index + 1) % kaomojis.length
      }
    }
    $(async function () {
      await FooterAnimator.init()
    })

    function populateNews(id, sliceLength) {
      $.getJSON("news.json", function (newsArray) {
        let news_content = "";
        const count = sliceLength || newsArray.length;
        const items = newsArray
          .map(item => {
            const [year, month, day] = item.date.split("-");
            return {
              dateObj: new Date(year, month - 1, day),
              headline: item.headline
            };
          })
          .sort((a, b) => b.dateObj - a.dateObj)
          .slice(0, count)
          .forEach(item => {
            const localDate = item.dateObj.toLocaleDateString(); // Format for display here
            news_content += `<tr><td>${localDate}:</td><td>${marked.parse(item.headline)}</td></tr>`;
          });

        $(`#${id}`).html(news_content);
      });
    }
  </script>
</body>

</html>