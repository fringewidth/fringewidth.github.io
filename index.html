<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>hrishik</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js"></script>
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <div id="navbar"></div>
  <div id="content"></div>
  <footer><div id="footer">(∪｡∪)｡｡｡zzZ</div></footer>
  <script>
    function loadMd(id, file) {
      $.get(file, md => $(id).html(marked.parse(md)))
    }

    function getParam(name) {
      return new URLSearchParams(window.location.search).get(name)
    }

    $(function () {
      $.getJSON("config.json", config => {
        loadMd("#navbar", config.navbar)
        const contentFile = getParam("content") || config.home
        loadMd("#content", contentFile)
      })
    })

    $(document).on("click", 'a[href$=".md"]', e => {
      e.preventDefault()
      const href = $(e.currentTarget).attr("href")
      history.pushState(null, '', '?content=' + href)
      loadMd("#content", href)
    })

    $(window).on("popstate", () => {
      $.getJSON("config.json", config => {
        const contentFile = getParam("content") || config.home
        loadMd("#content", contentFile)
      })
    })

    const FooterAnimator = {
      config: null,
      index: 0,
      interval: null,
      lastSleep: null,

      async init() {
        const response = await fetch("config.json")
        this.config = (await response.json()).footerAnimation
        this.update()
      },

      update() {
        const now = new Date()
        const time = new Date(now.toLocaleString("en-US", {timeZone: this.config.timezone}))
        const hour = time.getHours()
        const isSleep = hour <= this.config.sleepTime.start || hour < this.config.sleepTime.end
        
        if (this.lastSleep !== isSleep) {
          this.lastSleep = isSleep
          this.index = 0
          clearInterval(this.interval)
          this.interval = setInterval(() => this.update(), 
            isSleep ? this.config.intervals.sleep : this.config.intervals.awake)
        }

        const emojis = isSleep ? this.config.emojis.sleeping : this.config.emojis.awake
        const emoji = emojis[this.index]
        const formatted = time.toLocaleTimeString("en-US", {hour: 'numeric', minute: '2-digit', hour12: true})
        
        $("#footer").text(`it's ${formatted} here.... ${emoji}`)
        this.index = (this.index + 1) % emojis.length
      }
    }
    $(async function () {
      await FooterAnimator.init()
    })
  </script>
</body>
</html>
